# Tools
 - `Runas`
 - 
# Enumerating trough Microsoft Management Console (MMC)
## Using Runas
If we have the AD credentials in the format of :, we can use Runas, a legitimate Windows binary, to inject the credentials into memory. The usual Runas command would look something like this:
> runas.exe /netonly /user:\<domain\>\<username> cmd.exe

| Command               | Description                                                                                         |
| :---                  | :---                                                                                                |
| `/netonly`            | Load the credentials for network authentication but not authenticate against a domain controller. No credentials will be verified and will accept any password  |         
| `/user`               | Use the Fully Qualified Domain Name (FQDN)                                                          |
| `cmd.exe`             | Execute the program, in this case a command line interface                                          |
  
_Note: If you use your own Windows machine, you should make sure that you run your first Command Prompt as Administrator. This will inject an `Administrator token` into CMD. If you run tools that require local Administrative privileges from your Runas spawned CMD, the token will already be available. This does not give you administrative privileges on the network, but will ensure that any local commands you execute, will execute with administrative privileges._
  
# Manually configure DNS
Using the IP of the domain controller, we can execute the following commands in a PowerShell window:

Get Domain Controller IP:
> nslookup \<DOMAIN>
  
```PowerShell
$dnsip = "<DC IP>"
$index = Get-NetAdapter -Name 'Ethernet' | Select-Object -ExpandProperty 'ifIndex'
Set-DnsClientServerAddress -InterfaceIndex $index -ServerAddresses $dnsip
```
Aftr this verify that our credentials are working. The most surefire way to do this is to list `SYSVOL`. *Any AD account, no matter how low-privileged, can read the contents of the SYSVOL directory.*  

Force a network-based listing of the SYSVOL directory
> dir \\\\DOMAIN\SYSVOL\

_Note: When we provide the hostname, network authentication will attempt first to perform Kerberos authentication. Since Kerberos authentication uses hostnames embedded in the tickets, if we provide the IP instead, we can force the authentication type to be NTLM. While on the surface, this does not matter, it is good to understand these slight differences since they can allow you to remain more stealthy during a Red team assessment. In some instances, organisations will be monitoring for OverPass- and Pass-The-Hash Attacks. Forcing NTLM authentication is a good trick to have in the book to avoid detection in these cases._

## Microsoft Management Console (MMC)
This is where the Runas window comes into play. In that window, we can start MMC, which will ensure that all MMC network connections will use our injected AD credentials. You can start MMC by using the Windows Start button, searching run, and typing in MMC.

In MMC, we can now attach the AD RSAT Snap-In:

1. Click `File -> Add/Remove Snap-in`
2. Select and `Add` all three Active Directory Snap-ins
3. Click through any errors and warnings
4. Right-click on `Active Directory Domains and Trusts` and select `Change Forest`
5. Enter `<DOMAIN>` as the `Root domain` and Click `OK`
6. Right-click on `Active Directory Sites and Services` and select `Change Forest`
7. Enter `<DOMAIN>` as the `Root domain` and Click `OK`
8. Right-click on `Active Directory Users and Computers` and select `Change Domain`
9. Enter `<DOMAIN>` as the `Domain` and Click `OK`
10. Right-click on `Active Directory Users and Computers` in the left-hand pane
11. Click on `View -> Advanced Features`

If everything up to this point worked correctly, your MMC should now be pointed to, and authenticated against, the target Domain:

## Users and Computers
Look at 
 - AD Users and Computers.
 - Organisational Unit (OU) structure. 
 - User groups
 - Hosts and workstations

| Bnefits                                                       | Drawbacks                                                                               |
| :---                                                          | :---                                                                                    |
| The GUI provides an excellent method to gain a holistic view of the AD environment. | The GUI requires RDP access to the machine where it is executed.  |
| Rapid searching of different AD objects can be performed. | Although searching for an object is fast, gathering AD wide properties or attributes cannot be performed. |
| It provides a direct method to view specific updates of AD objects. |                                                                                   |
| If we have sufficient privileges, we can directly update existing AD objects or add new ones.                                                           |

# Enumeration through Command Prompt 
CMD has a built-in command that we can use to enumerate information about AD, namely  t. The net command is a handy tool to enumerate information about the local system and AD. We will look at a couple of interesting things we can enumerate from this position, but this is not an exhaustive list.
